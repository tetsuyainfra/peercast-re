// これしたときのログ
# ffmpegでtestsrc
https://nico-lab.net/testsrc_with_ffmpeg/

ffmpeg \
  -f lavfi -i testsrc2=1280x720:r=30:d=30 \
  -f lavfi -i sine=frequency=220:beep_factor=4:duration=30 \
  ./tmp/output.mp4


# ffmpegでrtmp send
ffmpeg -re -stream_loop -1 -i ./tmp/output.mp4 -vcodec libx264 -vprofile baseline -g 30 -acodec aac -strict -2 -f flv rtmp://localhost:11935

cargo test --package peercast-rt --lib -- rtmp::test::main --exact --nocapture

   Compiling peercast-rt v0.1.0 (/home/tetsuyainfra/work/peercast-rt)
    Finished test [unoptimized + debuginfo] target(s) in 4.72s
     Running unittests src/lib.rs (target/debug/deps/peercast_rt-42ff3212a43f9c74)

running 1 test
Listening for connections on port 11935
test rtmp::test::main has been running for over 60 seconds
Connection 0: Connection received from 127.0.0.1
handle_raised_event: ConnectionRequested { request_id: 0, app_name: "" }
Connection 0: Client requested connection to app ""
handle_raised_event: UnhandleableAmf0Command { command_name: "_checkbw", transaction_id: 2.0, command_object: Null, additional_values: [] }
Connection 0: Unknown event raised: UnhandleableAmf0Command { command_name: "_checkbw", transaction_id: 2.0, command_object: Null, additional_values: [] }
handle_raised_event: UnhandleableAmf0Command { command_name: "releaseStream", transaction_id: 3.0, command_object: Null, additional_values: [Utf8String("")] }
Connection 0: Unknown event raised: UnhandleableAmf0Command { command_name: "releaseStream", transaction_id: 3.0, command_object: Null, additional_values: [Utf8String("")] }
handle_raised_event: UnhandleableAmf0Command { command_name: "FCPublish", transaction_id: 4.0, command_object: Null, additional_values: [Utf8String("")] }
Connection 0: Unknown event raised: UnhandleableAmf0Command { command_name: "FCPublish", transaction_id: 4.0, command_object: Null, additional_values: [Utf8String("")] }
handle_raised_event: PublishStreamRequested { request_id: 1, app_name: "", stream_key: "", mode: Live }
Connection 0: Client requesting publishing on / in mode Live
Connection 0: Request accepted
Connection 0: Reader disconnected
handle_raised_event: StreamMetadataChanged { app_name: "", stream_key: "", metadata: StreamMetadata { video_width: Some(1280), video_height: Some(720), video_codec_id: Some(7), video_frame_rate: Some(30.0), video_bitrate_kbps: Some(0), audio_codec_id: Some(10), audio_bitrate_kbps: Some(67), audio_sample_rate: Some(44100), audio_channels: None, audio_is_stereo: Some(false), encoder: Some("Lavf58.76.100") } }
Connection 0: New metadata published for stream key '': StreamMetadata { video_width: Some(1280), video_height: Some(720), video_codec_id: Some(7), video_frame_rate: Some(30.0), video_bitrate_kbps: Some(0), audio_codec_id: Some(10), audio_bitrate_kbps: Some(67), audio_sample_rate: Some(44100), audio_channels: None, audio_is_stereo: Some(false), encoder: Some("Lavf58.76.100") }
handle_raised_event: VideoDataReceived { app_name: "", stream_key: "", data: b"\x17\0\0\0\0\x01B\xc0\x1f\xff\xe1\0\x19gB\xc0\x1f\xd9\0P\x05\xbb\x01\x10\0\0\x03\0\x10\0\0\x03\x03\xc0\xf1\x83$\x80\x01\0\x05h\xcb\x83\xcb ", timestamp: RtmpTimestamp { value: 0 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\0\x12\x08V\xe5\0", timestamp: RtmpTimestamp { value: 0 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\xde\x04\0Lavc58.134.100\0\x02|\xabZ\xe8\xd0T@\x87F\"\xd0\x89\x9bO7\x99\x9bk\x8b\x92\x11\x08\x10\xed\x91\xed\xad\xea\xa6\xecYXlm\x99yO\xf4\x9b\x02\tlF\x92U3\x16\xb0d+\x06b\xb9nn\xe9&\xa6\xf9\x95+\x1f[oO/\xd5\xda\xd4\x8bi\xd9\xe8\xd9(\xd6\xd1\xad\x9a\xb6j\xa9\xabf\xaa\xa8\xd2\x9bJkL\xb4\xcbL\x94\xcbL\x94\xcbL\xb4JD\x94\x89H\x94\x89D\x94\x0c\x0c\x0c\x0c\x0c\x0cl\xd8000000000000000000000004\xb2\xcb,\xb2\xcb,\xb2\xcb,\xb2\xcb.\xadP\0&&F\xfa@\xd0\x1f\x85!x\x97]\xa6\xc1m\x16\xbd\xad\xbc\x03{A~", timestamp: RtmpTimestamp { value: 0 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x01\x18\x98\xda\xd8=\xd6\xce\x84\xb5\r \xbb\xa9E\x07F\xa0\x07\xb6;_Ir5_\xc2y\xb8\x92\xdd#\xbe\x8a\x10\0\x19\x0f\x7f\x02!\xb5\xe4>\xd4\x95y\x0c.f\x871,|\tQdel<\\\x9f\x10\xdb\xca\xa4!\xc8nP\xc4%\xc9&\xf0\x86^\xba\xfc\xbe\xfe\xba;?\xf5(| \xff\xdd\xf0\x83kh\"!+o+\x10\x9e>\xcd\x01\0\x8e\x17\x10M\xc1#\xc5\xf5\xb49\x89o\xf8\xd4\xa8\x129Nk\xe2\xff\xea7\xbf\x13iO6w~\xf5\x06\xe6\xb4\xfb\xcc7\xff\x1b\xfc\xbf\xe6\xff7\xb8\xe0\xc0\xc1!7\\\x19\x14\xd3;\x83\x03Jri\x9d\xde\x15D\x1a\xbd\x15\xc3i\x13\xc1\xa4&\x0c\x85\xba\x9f\x12H\xdd\x0bXBT\xa0,L,_F\x06\x06\x06\x06\x06\x06\xbd`\xe1\xc4\xae\xa7>up", timestamp: RtmpTimestamp { value: 23 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x012\x98n\xd8=\xd6\xab\xbb/\xcc\xbb#\xc0@\xe7\xd4\xe2\xec\xeaZ\xd2[\xf8_\x9dN$\xb4\xff\xa3\xae\xb5\xae\"9\xea$\x92A\x90\xc7\x15\xc8p\xd2\x8c\x16\xa0;\xae\xd0'\xd3\xef\\\xa3@\xc3\xeb\xf7\xdc`\xceN^qX\xa3\xc7\xa6\xc4-\xb3\xc3\xbcF'\x8f\x1arT\x9b\xfb\xc4b]\xadVB\x12N>\x03\x18f~\\\x83\xe5\xd47\xec\xfet\xbf\xe4\x7fjz,\x98\xcf\x8b\xc1\x0f\xc6\xf9T\xc6{\x1f\xdd\x0e'\xfe\xdc?\x8a\x01\xfb?\xee\xff\xb7r\x01\xff\xef\x81\xff\xf7\x9c\x03\xff\x9f\xd9\xf9\xdf\xf9v\x7f\xf8\x80\x07\x90\xfe\xcd\xeb\xdfu\xfd7\xc5\0\x07\xef]\x1f\xf7^\xfb\xee\xdf\x1a\0\x0f\x98\xfes\xd4\x7fv\xe9\xffi\xf5\xdf\xbb\0\0~*\xfdP\x99=\xd0W\x14g\x82/<_\xce/\xe7\x11\xfc\xff\x9cG\xf3\xfea\x81\xc0", timestamp: RtmpTimestamp { value: 46 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x01 \xf5\xad-\"(\xabB\0q\x9fMg\x9euh\x92\x01@\xa0\xe0\x1b\xc8\x90NI\xb1\tI\xc5\x92\x8f\xdf\xc8\xf1N\x04F\xfc\xe21\xdeE\x05\xc0C\xeb\xb9\xa5\xd2\xb9\x13\x13SV8\xcc\x84\xee\xee\xf89\xd3\x8e8\xe3\xe10;\xd7\x83\xf6\xc8,\xd8\xe3\x8b2=xa\x86\x12\t\xb68\xe3\x8c\xc0O]u\xbb\x8068\xe3\x8b ;\xe1$\x8e\xe0\r3R\xc8N\xef#\xb9\x1b33 #\xbb\xd6\xe2\xe2\xcc\xcd\xf0e{\xf6\x87\xfe>\x12\xafu\xae\x9f\x1c\xd45\x9f\xddY\x9f0L\xb9\xd4\x8bF@\xef\xa2\\T\xc9+\xa8\xa5#'\x04\xe8\xd3h\x14\xc5;\xaf\x06\xf4\xef)\x11\xb7r\xe1B\xca\xa6\x08\x95\x80\"\x0e", timestamp: RtmpTimestamp { value: 69 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x01\x085\xac\x8dT9\x10N\x0e:\xea\x10@\x02\xa9T\xa1J\xa5P5\x95\xc0I=(\x93?\x13\x04\xfeb\xfc\x08'\xc1\xd3\xd9\xf4\xd7K\xf5\xd7\xe6\xf2y\xbb\xb1\x93\x1c)\x92\x90gG\xa6\xb3\x14\x95\x05\x1d$\x17\x8b\x1c\tIm\x12\xc1\x8d|\x84;\xcd\xe5\xd0\xe1\xa5\x9dH\x1c\x8aj\x8e\xd5Z-J\xe0N\xc8f\xb1]],Cezd\xd68h\xe6\xe8\x8a\xd7\xf5R3\x82u\xfb\xbf1C\xba4\x9et\xf9\x97j\x10|\x19\xbb\x85\xfa\xd8)\xdcSh*\xbd\xb3\x1d\xe4y\tt\x0cPE)b\x91wC}\xcb\xa5,\xa9\xbd\x92\x8a\x95\xd2\x99\xd0\x9a\x1d\xe1K\xc2\xb2\xd5\x12\xa9\xdaYl\"lVZH\xa4Y\x16\xc0R\xb3\xb1)\x07", timestamp: RtmpTimestamp { value: 93 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\0\xfe5\xac\x94vj\x11N'\xd0\x81\xf1\xab\0\0\x05P\xa5*\xa9\xe4\x01\xab\xb0\th;\xb1-_\xe6P\x9f\xf2\x85\xf8\xeeO\xe0\x1b\xe6{\x13\xcf\xaa\x89\x8e\x8d\xadVqM[5l\xb53V\xf23\x83\xeb}\x1b\x99X\x16\x11\xccYf\x86\xc0\xeagk\x81\xd2b\0\x14%\x15\xd6\xd5\xa3Yb\x94;\x0b\x11\x83B\x1b\n\x96\xb4\x88\xfd\xf6\xfaW\xc5\x9c\x9d*\xd4\xf8\x89\x11:\xed\x08\x1eV\xa50\xa4\x19\xaf.\\\xb98\xbe\x0e\x1f?\x87\x1f\x91\xf2r\xe2|\x9c\xb9\x87.\x1c\xf8\xf2\xe2qq\xe7\xc3\x87 $\x9c\xc4\x14\xd1p\xdc\xd4\xa5P\xbeN\x03\x8f>N<\xc7\x0e\\\xb8\x01\xf2|\x1c9\xf2\x9d\xabkM\xca:uCM4\xa6\xb4\n\x8c(\xa4\x9b\xa8 P\x12\x84\x83\x80", timestamp: RtmpTimestamp { value: 116 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\0\xfe5\xad\x0c\xd4+\x05\n+\x03\xdb\x88 \0\x14\xaaQJU(\x03\x8f\x94I\xea\xf3\xc4\xf6\xff\t\x89\x7f;\x1e\xe7c|;\xa1\xaf\xbc\xcd\x1e^\x1bM\x97\xf2\xcc\xd2M$\xc33\xb35j\xf7\xce\xae=\xe6MX\x13@Y-\xa6L\xae\xd7\xcc\xa0\xba\x8e)PX\x10\xe4%\xcc\x02\xc6\xe1c\xd3\x82\xd1H\xed\xed\xc0=\xae\xd7\xe4J\xfdG=\x03\xd9\xdc\x89#z\x13\x8484\n\xf1\xfb\xe0\xb0\x06\xabJ\xd0\x90\x91$\xb6\xc3\x06q\xc9\xc5\xa1F\xf9\xd5Q\xca\xa7m\x90\xaf\x8d\x1c\x0b\x87\\\x15\x93\x05\xf6\xfct_\xe3N\x95\x9c/N/\x8d\xea\xafYp\xec\xdb%%\xae\x14]\x1f\xc5\xb6\xbc\xa8\x9a\xbe\0H\xa7U3\x952\xa9!B\x85\xdc", timestamp: RtmpTimestamp { value: 139 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x01\x065\xac\x8dr\x80<\xf9\xb6\xb0\x84\0UR\x94)T\xaa\x06'\xc4I\xd0\xe7\xe4\xea\xfe\x16\x89~O\xbd\xd8K\xc0\x08\x95\x99v~\\\xfc\xbe9Y\x07\x06P(p0p\xb0\xc4\x9b\xc4\xdf'A\xb9og\x1e*H\xaabM\xd5\x9c\xe2I\x01\t\xa7\x1b\x8f\"\xb4\xae'y\xc6\x8b\xe9b\x11\x98\x8c\xfb\x9b\x14\xa28$\xb1x\x88\xb4\",\xe2CY\x88\xc5\\\x86(\xb0P\xcd\xfc}?\x97f\xf3\xfc\xfe>>}\xb4\xe3\x9f\xb4\xd3\xea\x7f\xc6\xfe\x8d\xf1\x0e\xfa\xe8\xbf=\x97~\xf2\xf4H\xf8`V?~A\xb7$\xe1g\xfc\xbde\xe0\x82[\xaa\x84\xd0\x7f*\xc6/iv\xc9\xae\xae\xcep\xc7R\xbb\xb1R\x02\x0e\xb4\x99UE\xe2\xed\x89\x01\xf1Y\x190>\xc6q>\xe7BD S\xda-\x03\x80", timestamp: RtmpTimestamp { value: 162 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x01\x085\xac\x8dt)\x14L\x0e\xbe,\x82 \x02\xaa\x94\xa1J\xa5P1\xef\"\xd6\xfdR\xd3\xfcg\x92\xe9\x7f\x08\tGTe\xca\xfd\xd4\xf9\xf5\xf9\xf9\xd7K\xd3\x84\xda\xa6z]\x01\x9eaeQ\xa0\xc8g\x91\x82\xfe\x97\x92X\xcf\xc5\xdc\r\xfci\t'\x83\xc2\x07\xc0b\xf0\x91\x98\x89\x86\xd0&\0\x9cPZ\xa18\xb6\xe3Aj\x85\x92)\xa8\xa4\x90\xe2-22\xb2w\xde\x8edd\xb3J\x9b\x9b\xf7\xfbV\x80/ppFdd\x0b\xd0\x08D\xf1\xa5\\\xbdL\xce+\"`\x99\x93\xc2\xa4\xad\xccq\xb0\x9f\xb49M\xa5Z\x84\x91\xef\x89yU\xa3\x97\xdb\xce\xb7\x04\xdf\xc9}\xa4\x9b&\xd9\x1e\xfbdA\xc7U\x93&\xd1\xeeb\xca\x11\xf8{\x13\x9d\xad\xd8\xeb\x17\xa6\x85\x8cHR\xcdR\x8a\x11fp", timestamp: RtmpTimestamp { value: 186 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\0\xe45\x806:;A\x04J\x12\x7fa\xc7\\X\x84\0*\x95J\x14\xa5Pa\xe4et\xf24?\x16\xc4?\x14\xbf\x05Hv5L\x89bh\xc8\xcdM5l\xd5\xb3V\xcaU\n4\x94IMw\xd6\x85c\xebp\xb6\x81\xa0ZK\xebQ\x94\xd2\x19\xe1\x117\x82\x9d\x08\x08\x83\xe8X\x07Tr\xb4\x15H\xd6\x9a\xc5\xa1\x88\x8b^\n\xd7V\xc3\\\x1dC\x122%\"\x87%p\x01f\x1c\x95\x9e\xe8\0\x1f'\xab\xbf\x96b\x86\x03\x1e+\xb4[\x91\nV\xaf\x0f\x04\xfa9\xd5wP\xc0\xbe\xb5\xb8\x96t\xcf\xd1\xab\x984#\xf6q\x0f\xc3\x08J\xff\xe8\xdb\x84\x18+B4N\"\xf4Lhx]O\x92\xaa\xea\x0c\x9c^\xc3-!C\x8c\x86,\x11\x1d_\xa8B\x04\x99\xef\x82\x12\xc7a\xa8\x95Q8", timestamp: RtmpTimestamp { value: 209 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x01\x085\xac\x8d\x14A\x1cN\x0b\xf3\xc5\x88D\0\xcaU\x14R\x95@Y\xd9\x0c\x8d|y\x1b\xbe\xcf!\xf9\xfb\xe9\x95'\x89(H\x0f4\x94j\x9b\xb7\x1dS=213\xde\xf4\xb9\xbd\x8e\xd0\x8e\xc6\xa6p ju\x1b\xd2\xf1& \x16\xf3\xb4 \"\xc9f\x8c\xe06\xcf\xac\xf65\xfd\x94f\xc3:\xfb\xc3<\xfc,bY\xb5\xab\x7f$H\x04\xc1\xe0\xcb\xe9\x8bU\x8dJn\0\x80K\xc5\xcbL\xc0z\x01\x91\xd1\xd5\x98\x07\xb3\\\xc2\xed\xb4\xd1)\xaa\x15\xd4\xa4{b_uyL:\x06\x1bw\xf8\xad\x116\xe3uR\xf0\xc2+Ukx1\xd7\xe9\xc5bu]\xdf[=o -\xef\xb5\x18T\xe6\xf5X\xa8\x12\x0e\xe0\xe0", timestamp: RtmpTimestamp { value: 232 } }
handle_raised_event: AudioDataReceived { app_name: "", stream_key: "", data: b"\xaf\x01\x0165\xa2i=+\xe7\xec\xffh\x89P@\x02\0\x07\xb8\x0c\x9eT6\x03\xa9\x02\xfeN\x1f\x03\x87\x91\x97\x91\x97\x91W\x91WQN\x85:\x14\xe8Sa\xb6\x1ba\xb6\x1ba\xb6\x1ba\xb6\x1ba\xb6\x1ba\xb6\x1ba\xb6\x1bA4\x13\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03\x03#w'w~", timestamp: RtmpTimestamp { value: 255 } }
handle_raised_event: VideoDataReceived { app_name: "", stream_key: "", data: b"\x17\x02\0\0\0", timestamp: RtmpTimestamp { value: 2147483647 } }
handle_raised_event: UnhandleableAmf0Command { command_name: "FCUnpublish", transaction_id: 7.0, command_object: Null, additional_values: [Utf8String("")] }
Connection 0: Unknown event raised: UnhandleableAmf0Command { command_name: "FCUnpublish", transaction_id: 7.0, command_object: Null, additional_values: [Utf8String("")] }
handle_raised_event: PublishStreamFinished { app_name: "", stream_key: "" }
Connection 0: Client disconnected
Stream manager is removing connection id 0
Stream manager is removing connection id 0
Connection 0: Writer disconnected